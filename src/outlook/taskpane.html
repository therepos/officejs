<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>OfficeJS Tools</title>
  <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
  <style>
    body { font:14px Segoe UI, sans-serif; padding:12px; line-height:1.5; }
    button { margin:4px 0; padding:6px 12px; }
    #status { margin-top:10px; color:#666; }
  </style>
</head>
<body>
  <h3>OfficeJS Tools</h3>
  <button id="btnFormat">Format tables (1pt grey, 0.1in)</button><br>
  <button id="btnImg60">Resize all images to 60%</button><br>
  <button id="btnWebdings">Set all text to Webdings (test)</button><br>
  <button id="btnReset">Reset fonts to Segoe UI</button>

  <div id="status"></div>

<script>
Office.onReady(() => {
  const status = msg => document.getElementById('status').textContent = msg;

  function getHtml(){return new Promise(r=>{
    Office.context.mailbox.item.body.getAsync(Office.CoercionType.Html, x=>r(x.value||""));
  });}
  function setHtml(h){return new Promise(r=>{
    Office.context.mailbox.item.body.setAsync(h,{coercionType:Office.CoercionType.Html},()=>r());
  });}

  async function formatTables(){
    status("Formatting tables…");
    const html = await getHtml(), div=document.createElement('div'); div.innerHTML=html;
    const border='1pt solid #d9d9d9', pad='0.1in';
    div.querySelectorAll('table').forEach(t=>{
      t.style.borderCollapse='collapse';
      t.style.border=border;
      t.querySelectorAll('th,td').forEach(c=>{
        c.style.border=border; c.style.padding=pad;
      });
    });
    await setHtml(div.innerHTML); status("Tables formatted ✓");
  }

  async function resizeImages60(){
    status("Resizing images to 60%…");
    const html = await getHtml(), div=document.createElement('div'); div.innerHTML=html;
    const scale = 0.6;
    div.querySelectorAll('img').forEach(img=>{
      const w = img.width || img.naturalWidth;
      const h = img.height || img.naturalHeight;
      if (w && h) {
        img.style.width  = Math.round(w*scale) + 'px';
        img.style.height = Math.round(h*scale) + 'px';
      } else {
        img.style.width = '60%';
        img.style.height = 'auto';
      }
      img.style.maxWidth = '100%';
    });
    await setHtml(div.innerHTML); status("Images resized ✓");
  }

  async function webdings(){
    status("Applying Webdings…");
    const html = await getHtml(), div=document.createElement('div'); div.innerHTML=html;
    div.querySelectorAll('p,div,span,td,th,li,h1,h2,h3,h4,h5,h6')
        .forEach(el=>el.style.fontFamily='Webdings');
    await setHtml(div.innerHTML); status("Webdings applied ✓");
  }

  async function resetFonts(){
    status("Resetting fonts…");
    const html = await getHtml(), div=document.createElement('div'); div.innerHTML=html;
    div.querySelectorAll('p,div,span,td,th,li,h1,h2,h3,h4,h5,h6')
        .forEach(el=>el.style.fontFamily='Segoe UI, Arial, sans-serif');
    await setHtml(div.innerHTML); status("Fonts reset ✓");
  }

  document.getElementById('btnFormat').onclick = formatTables;
  document.getElementById('btnImg60').onclick  = resizeImages60;
  document.getElementById('btnWebdings').onclick = webdings;
  document.getElementById('btnReset').onclick  = resetFonts;
});
</script>
</body>
</html>
