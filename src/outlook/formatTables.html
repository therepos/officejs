<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>OfficeJS Format Tables</title>
  <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
  <script>
    Office.onReady(() => {
      // Must be global for command button and task pane
      window.formatTables = function(event) {
        try {
          // Toast notification to prove execution
          if (Office.context.mailbox.item?.notificationMessages) {
            Office.context.mailbox.item.notificationMessages.replaceAsync("fmtStatus", {
              type: Office.NotificationMessageType.InformationalMessage,
              message: "Formatting (Webdings test)…",
              icon: "icon16",
              persistent: false
            });
          }

          // Read current body as HTML
          Office.context.mailbox.item.body.getAsync(Office.CoercionType.Html, function(res) {
            if (res.status !== Office.AsyncResultStatus.Succeeded) {
              if (event?.completed) event.completed();
              return;
            }

            const wrapper = document.createElement("div");
            wrapper.innerHTML = res.value;

            // Apply obvious font change
            wrapper.querySelectorAll("p, div, span, td, th, li, h1, h2, h3, h4, h5, h6").forEach(el => {
              el.style.fontFamily = "Webdings";
            });

            // Write back modified HTML
            Office.context.mailbox.item.body.setAsync(wrapper.innerHTML,
              { coercionType: Office.CoercionType.Html },
              () => {
                if (Office.context.mailbox.item?.notificationMessages) {
                  Office.context.mailbox.item.notificationMessages.replaceAsync("fmtStatus", {
                    type: Office.NotificationMessageType.InformationalMessage,
                    message: "Fonts changed to Webdings ✓",
                    icon: "icon16",
                    persistent: false
                  });
                }
                if (event?.completed) event.completed();
              });
          });
        } catch (e) {
          if (event?.completed) event.completed();
        }
      };
    });
  </script>
</head>
<body>
</body>
</html>
